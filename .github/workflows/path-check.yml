name: Community PR Path Check

on:
  pull_request:
    branches: [dev, main]

jobs:
  path-check:
    name: path-check
    runs-on: ubuntu-latest
    if: >
      github.event.pull_request.author_association != 'MEMBER' &&
      github.event.pull_request.author_association != 'OWNER'
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Check community PR only touches community folder
        run: |
          echo "üîç Checking files changed in this PR..."

          CHANGED_FILES=$(git diff --name-only origin/${{ github.base_ref }}...HEAD)

          if [ -z "$CHANGED_FILES" ]; then
            echo "‚úÖ No files changed."
            exit 0
          fi

          echo "Changed files:"
          echo "$CHANGED_FILES"
          echo ""

          VIOLATION=false

          while IFS= read -r file; do
            if [[ "$file" == community/* ]]; then
              echo "‚úÖ $file"
              continue
            fi

            echo "‚ùå $file (NOT ALLOWED)"
            VIOLATION=true
          done <<< "$CHANGED_FILES"

          if [ "$VIOLATION" = true ]; then
            echo ""
            echo "============================================"
            echo "üö´ BLOCKED: Community PRs can ONLY modify:"
            echo "   ‚Ä¢ community/your-ability-name/"
            echo ""
            echo "   You cannot modify any other files."
            echo "   If you need changes elsewhere, open an"
            echo "   issue to discuss with maintainers."
            echo "============================================"
            exit 1
          fi

          echo ""
          echo "‚úÖ All changed files are inside community/ folder!"

  path-check-member:
    name: path-check
    runs-on: ubuntu-latest
    if: >
      github.event.pull_request.author_association == 'MEMBER' ||
      github.event.pull_request.author_association == 'OWNER'
    steps:
      - run: echo "‚úÖ Org member ‚Äî all paths allowed"
